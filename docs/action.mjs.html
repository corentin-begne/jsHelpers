<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: action.mjs</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"JsHelpers","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">JsHelpers</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="ActionHelper">
            <span class="title">
                <a href="ActionHelper.html">ActionHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="ActionHelper#complete"><a href="ActionHelper.html#complete">complete</a></li>
            
                <li data-name="ActionHelper#execute"><a href="ActionHelper.html#execute">execute</a></li>
            
                <li data-name="ActionHelper#redirect"><a href="ActionHelper.html#redirect">redirect</a></li>
            
                <li data-name="ActionHelper#setAjaxSetting"><a href="ActionHelper.html#setAjaxSetting">setAjaxSetting</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="ActionHelper#event:error"><a href="ActionHelper.html#event:error">error</a></li>
            
                <li data-name="ActionHelper#event:progress"><a href="ActionHelper.html#event:progress">progress</a></li>
            
                <li data-name="ActionHelper#event:success"><a href="ActionHelper.html#event:success">success</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="GtagHelper">
            <span class="title">
                <a href="GtagHelper.html">GtagHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="GtagHelper#init"><a href="GtagHelper.html#init">init</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="JsHelper">
            <span class="title">
                <a href="JsHelper.html">JsHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="JsHelper#add"><a href="JsHelper.html#add">add</a></li>
            
                <li data-name="JsHelper#addGlobalFunction"><a href="JsHelper.html#addGlobalFunction">addGlobalFunction</a></li>
            
                <li data-name="JsHelper#init"><a href="JsHelper.html#init">init</a></li>
            
                <li data-name="JsHelper#isApple"><a href="JsHelper.html#isApple">isApple</a></li>
            
                <li data-name="JsHelper#isMobile"><a href="JsHelper.html#isMobile">isMobile</a></li>
            
                <li data-name="JsHelper#isTablet"><a href="JsHelper.html#isTablet">isTablet</a></li>
            
                <li data-name="JsHelper#ucfirst"><a href="JsHelper.html#ucfirst">ucfirst</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="WebsocketHelper">
            <span class="title">
                <a href="WebsocketHelper.html">WebsocketHelper</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="WebsocketHelper#clearEvents"><a href="WebsocketHelper.html#clearEvents">clearEvents</a></li>
            
                <li data-name="WebsocketHelper#connect"><a href="WebsocketHelper.html#connect">connect</a></li>
            
                <li data-name="WebsocketHelper#deleteEvent"><a href="WebsocketHelper.html#deleteEvent">deleteEvent</a></li>
            
                <li data-name="WebsocketHelper#init"><a href="WebsocketHelper.html#init">init</a></li>
            
                <li data-name="WebsocketHelper#send"><a href="WebsocketHelper.html#send">send</a></li>
            
                <li data-name="WebsocketHelper#setEvent"><a href="WebsocketHelper.html#setEvent">setEvent</a></li>
            
                <li data-name="WebsocketHelper#setEvents"><a href="WebsocketHelper.html#setEvents">setEvents</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="WebsocketHelper#event:disconnect"><a href="WebsocketHelper.html#event:disconnect">disconnect</a></li>
            
                <li data-name="WebsocketHelper#event:onerror"><a href="WebsocketHelper.html#event:onerror">onerror</a></li>
            
                <li data-name="WebsocketHelper#event:onerror"><a href="WebsocketHelper.html#event:onerror">onerror</a></li>
            
                <li data-name="WebsocketHelper#event:onmessage"><a href="WebsocketHelper.html#event:onmessage">onmessage</a></li>
            
                <li data-name="WebsocketHelper#event:onopen"><a href="WebsocketHelper.html#event:onopen">onopen</a></li>
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="action.mjs.html">Source: action.mjs</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source "><code>import $ from "../../jQuery/src/jquery.js";

/**
 * @name ActionHelper
 * @class
 * @hideconstructor
 * @property {DOMElement} [body = $("body")] Body element of the page
 * @property {DOMElement} [loader = "&lt;div class='backdrop'>&lt;div id='loader'>&lt;/div>&lt;/div>"] Loader element for ajax requests
 * @property {String} [app = this.body.attr("app")] Application name
 * @property {String} [basePath = "/"+(this.app==="frontend" ? '' : this.app+"/")] Ajax requests base path
 * @property {Number} [progress = 0] Value of the ajax request progress
 * @description Manage ajax requests and redirections - singleton
 */
class ActionHelper{  

    constructor(){
        this.body = $("body");
        this.loader = "&lt;div class='backdrop'>&lt;div id='loader'>&lt;/div>&lt;/div>";
        this.app = this.body.attr("app");
        this.basePath = "/"+(this.app==="frontend" ? '' : this.app+"/");
        this.progress = 0;
        const hasOnProgress = ("onprogress" in $.ajaxSettings.xhr());
        var oldXHR;
        if (hasOnProgress) {   
            //patch ajax settings to call a progress callback
            oldXHR = $.ajaxSettings.xhr;
            $.ajaxSettings.xhr = setAjaxSetting;
        }

        /**
         * @method ActionHelper#setAjaxSetting
         * @private
         * @description Allow to get ajax requests progress
         * @return {XMLHttpRequest} Xhr request
         */
        function setAjaxSetting(){
            const xhr = oldXHR();
            if(xhr instanceof XMLHttpRequest) {
                xhr.addEventListener("progress", this.progress, false);
            }
            
            if(xhr.upload) {
                xhr.upload.addEventListener("progress", this.progress, false);
            }
            
            return xhr;
        }
    }

    /**
     * @method ActionHelper#execute
     * @param {Object|FormData} [data = {}] Data to send
     * @param {Object} [options = {}] Request options
     * @param {Boolean} [options.noload = false] Show or not the loader while request progressing
     * @param {String} [options.type] Request type: post or get
     * @param {String} [options.action] Request path
     * @param {String} [options.dataType] Request dataType: xml, json, script, text or html
     * @param {Boolean} [options.form = false] Set to true if the request send FormData
     * @description Execute an ajax request
     * @return {Promise} Request promise
     */
    execute(data = {}, options = {}){
        var that = this;
        if(!options.noload){
            this.body.append(this.loader);
        }
        const infos = {
            type:options.type,
            data,
            url: this.basePath+options.action+(window.PHPSESSID?`?PHPSESSID=${PHPSESSID}`:''),
            dataType:options.dataType
        };        
        if(options.form){
            Object.assign(infos, {
                cache:false, 
                contentType:false, 
                processData:false
            });
        }  

        return new Promise(runExecute);

        /**
         * @method ActionHelper#runExecute
         * @private
         * @description Run the Promise of the execute function
         * @callback [resolve] Promise resolve callback on request success
         * @param {Object|String} [data] Result of the request
         * @callback [reject] Promise reject callback on request error
         * @param {Event} [event] Ajax error event
         */
        function runExecute(resolve, reject){
            Object.assign(infos, {
                error, 
                complete,  
                progress, 
                success
            });
            $.ajax(infos);

            /**
             * @event ActionHelper#progress
             * @private
             * @description Update progress value on request progression
             * @param {Event} [event] Event Data
             */
            function progress(event){
                that.progress = event.loaded / event.total;     
            }   

            /**
             * @event ActionHelper#error
             * @private
             * @description Execute reject Promise callback on error
             * @param {Event} [event] Event data
             */
            function error(event){
                reject(event);
            }

            /**
             * @event ActionHelper#success
             * @private
             * @description Execute resolve Promise callback on success
             * @param {Object|String} [data] Request data
             */
            function success(data){
                resolve(data);
            }

            /**
             * @method ActionHelper#complete
             * @private
             * @description Remove loader and reset progress value on request complete
             */
            function complete(){
                if(!options.noload){
                    $("body > .backdrop").remove();
                }
                that.progress = 0;
            }
        }        
    }

    /**
     * @method ActionHelper#redirect
     * @param {Map.&lt;String, String>} [data] Contain path and type (self, blank, parent, top) to redirect, by default redirect the current page.
     */
    redirect(data){
        if(!data.has("type")){
            window.location.href = data.get("path");
        } else {
            window.open(window.location.origin+data.get("path"), "_"+data.get("type"));
        }
    }

}

const actionHelper = new ActionHelper();
export default actionHelper;</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on Sun Jul 16 2023 18:45:31 GMT+0200 (heure d’été d’Europe centrale)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
